<!DOCTYPE html>
<html lang = "en">
<head>
  <meta charset = "utf-8">
  <title>D3 Page Template</title>
  <script type = "text/javascript" src = "d3.js"></script>
  <style type = "text/css">

  body{
    font-size: 10px;
  }


  rect:hover{
    fill: white;
  }

  #tooltip{
    position: absolute;
    width: 100px;
    height: auto;
    padding: 10px;
    background-color: white;
    -webkit-border-radius: 10px;
    -moz-border-radius: 10px;
    border-radius: 10px;
    -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
    -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0,  0.4);
    box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
    pointer-events: none;
  }

  #tooltip.hidden{
    display: none;
  }

  #tooltip p{
    margin: 0;
    font-family: sans-serif;
    font-size: 16px;
    line-height: 20px;
  }

  svg{
    background-color:  #707589;
  }

  .axisTitle{
    font-family: sans-serif;
    fill: #D1D1D1;
  }

  .yAxis text {
    fill: #D1D1D1;
  }

  .yAxis path, line {
    stroke: #D1D1D1;
  }

  </style>
</head>
<body>

  <div id = "tooltip" class = "hidden">
    <p><span id = "value">100</span> protests</p>

  <script type = "text/javascript">


  var w = 800;
  var h = 400;
  var padding = 40;
  var axisPadding = padding + 10;
  var axisTitlePadding = axisPadding + 10;
  var barPad = 1;



   var rowConverter = function(d) {
     return{
       count: parseInt(d.count),
      };
    }


   d3.csv("ppw_justcount.csv", rowConverter, function(data){

     var dataset = data;
        drawChart(dataset);
      });


drawChart = function(d){

  console.log(d);

        var    xScale = d3.scaleBand()
                         .domain(d3.range(d.length))
                         .rangeRound([padding, w - padding]);

        var    yScale = d3.scaleLinear()
                        .domain([0, d3.max(d[0])])
                        .rangeRound([0, h - padding]);

        var    yAxisScale = d3.scaleLinear()
                              .domain([0, d3.max(d[0])])
                              .rangeRound([h, 0+padding]);

        var    xAxis = d3.axisBottom()
                          .scale(xScale);

        var    yAxis = d3.axisLeft()
                          .scale(yAxisScale)
                          .ticks(8);

        var    svg = d3.select("body")
                       .append("svg")
                       .attr("width", w)
                       .attr("height", h+20);

       svg.selectAll("rect")
           .data(d)
           .enter()
           .append("rect")
           .attr("x", function(d, i){
             return xScale(i);
           })
           .attr("y", function(d){
             return h - yScale(d[0]);
           })
           .attr("width", xScale.bandwidth() - barPad)
           .attr("fill", "#D1D1D1")
           .attr("height", function(d){
             return yScale(d[0]);
           })
           .on("mouseover", function(d){
             var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.bandwidth()*2.5;
             var yPosition = parseFloat(d3.select(this).attr("y"))-35;

             d3.select("#tooltip")
               .style("left", xPosition + "px")
               .style("top", yPosition + "px")
               .select("#value")
               .text(d[0])

               d3.select("#tooltip").classed("hidden", false);

           })
           .on("mouseout", function(d){
             d3.select(this)
               .attr("fill", "#D1D1D1");
             d3.select("#tooltip").classed("hidden", true);
           })
           ;

        svg.append("g")
            .attr("class", "yAxis")
            .attr("transform", "translate(" + axisPadding + ",0)")
            .call(yAxis);

        svg.append("text")
           .attr("x", axisTitlePadding)
           .attr("y", yAxisScale(d3.max(d[0])))
           .attr("class", "axisTitle")
           .text("Protests per week");

}

  </script>
</body>
</html>
